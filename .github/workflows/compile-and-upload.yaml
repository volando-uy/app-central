name: compile-and-upload.yaml

on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

env:
  JAR_NAME: VolandoUY-1.0-SNAPSHOT.jar

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
        
      - name: Setup Java JDK
        uses: actions/setup-java@v5.0.0
        with:
          distribution: 'zulu'
          java-version: 17

      - name: Compile JAR
        run: |
          cd VolandoUY && mvn clean package -Dmaven.test.skip=true

      - name: Publish the new JAR
        run: |
          mkdir -p release
          rm -f release/*.jar
          mv VolandoUY/target/$JAR_NAME release/$JAR_NAME

      - name: Create Pull Request with Updated JAR
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          add-paths: 'release/${{ env.JAR_NAME }}'
          
          branch: 'feature/compiled-jar-release-${{ github.run_id }}'
          
          # PR and Commit details
          commit-message: 'chore: compile and update new JAR release'
          title: '[AUTO] New JAR release'
          body: 'This PR was automatically generated with the newly compiled JAR file in the `release/` directory.'
          base: 'main' # Target branch for the PR

